services:
  lumo-bridge:
    build:
      context: .
      target: production
    container_name: lumo-bridge
    user: "1000:1000"
    ports:
      - "${PORT}:${PORT}"
      # - "9222:9222"  # Chrome Remote Debugging
    env_file:
      - .env
    environment:
      # Production-specific overrides
      - HEADLESS=${HEADLESS:-true}
      - USER_DATA_DIR=/app/user-data
      - DISPLAY=${DISPLAY:-99}
      - NODE_ENV=${NODE_ENV:-production}
    volumes:
      # Persist browser profile data
      - ./user-data:/app/user-data
      # - /tmp/.X11-unix:/tmp/.X11-unix:rw
    # Required for Chrome sandbox
    security_opt:
      - seccomp:unconfined
    shm_size: 2gb
    restart: unless-stopped
