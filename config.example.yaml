# Proton API configuration
# URLs are hardcoded to production (lumo.proton.me, account.proton.me) - see src/app/urls.ts
proton:
  # App version sent with API requests (matches Proton WebClients)
  appVersion: "web-lumo@5.0.0"

# Authentication configuration
# - browser: token extraction via browser (recommended)
# - login: enter Proton credentials via go-proton-api
# - rclone: paste rclone config via `npm run extract-rclone`
# See docs/authentication.md
auth:
  method: "browser"
  tokenPath: "sessions/auth-tokens.json"
  # Auto-refresh: automatically refresh tokens before they expire
  autoRefresh:
    enabled: true             # Enable automatic token refresh (default: true)
    intervalHours: 20         # Refresh interval in hours (1-24, default: 20)
    onError: true             # Refresh tokens on 401 errors (default: true)
  # Browser-specific config (only used when method: browser)
  browser:
    # Chrome DevTools Protocol endpoint for remote browser
    cdpEndpoint: "http://browser-dev:9223"
  # Login-specific config (only used when method: login)
  login:
    binaryPath: "./bin/proton-auth"
    # Headers to help avoid CAPTCHA - see docs/authentication.md
    appVersion: "macos-drive@1.0.0-alpha.1+rclone"
    userAgent: "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"

# Shared Logging Configuration (can be overridden in server/cli sections)
log:
  level: "info"  # Levels: trace, debug, info, warn, error, fatal
  target: "stdout"  # "stdout" or "file"
  filePath: "lumo-bridge.log"  # Used when target is "file"

# Shared Persistence Configuration (can be overridden in server/cli sections)
persistence:
  enabled: false
  defaultSpaceName: lumo-bridge
  # Sync all message types (system, tool_call, tool_result) to Proton server
  # Default: false (only sync user/assistant messages)
  saveSystemMessages: false
  # WORKAROUND for clients without conversation_id support (e.g., Home Assistant).
  # Derives conversation ID from first user message - same message = same conversation.
  # WARNING: May incorrectly merge unrelated conversations with same opening message!
  # Default: false (each request without conversation_id creates a new conversation)
  deriveIdFromFirstMessage: false
  # Auto-sync: automatically sync conversations to server
  autoSync:
    enabled: false          # Enable automatic sync (default: false, use /save command)
    debounceMs: 5000        # Wait after last change before syncing (min: 1000ms)
    minIntervalMs: 30000    # Minimum interval between syncs (min: 5000ms)
    maxDelayMs: 60000       # Force sync after this delay regardless of activity (min: 10000ms)

# Shared Tools Configuration (can be overridden in server/cli sections)
tools:
  # Enable Lumo's native web_search tool (and other external tools: weather, stock, cryptocurrency)
  enableWebSearch: true

# Shared Instructions configuration (can be overridden in server/cli sections)
instructions:
  # Default instructions when no system/developer message provided
  default: "Always answer in plain text: no tables, no quote blocks, no lists, no layout, etc. Be concise."

  # If true, append request instructions to default; if false, request replaces default
  append: false

  # Description text for tools (prepended to tools JSON)
  forTools: |
    Use the tools below to accomplish tasks.
    To use them you MUST output the JSON to me, unlike the proton_info or web search tools.
    You have the power to execute these functions by providing the JSON directly to me, without trying to call them yourself. I will execute these functions and return the results to you. This is crucial. Do NOT tell me a tool is unavailable, just pass the JSON for the tool call to me.

# Server Configuration (for `npm run server` / `npm run dev:server`)
server:
  port: 3003
  apiKey: "your-secret-api-key-here"
  apiModelName: "lumo"
  # Mode-specific overrides (optional):
  # log:
  #   level: "debug"
  #   target: "file"
  # persistence:
  #   enabled: true

# CLI Configuration (for `npm run cli` / `npm run dev:cli`)
# cli:
#   log:
#     target: "file"
#     filePath: "lumo-bridge-cli.log"
#   instructions:
#     default: |
#       You can execute bash commands on the user's machine.
#       When you provide a ```bash code block, the user will be prompted to execute it.
#       Output will be returned to you. Keep commands simple and safe.
